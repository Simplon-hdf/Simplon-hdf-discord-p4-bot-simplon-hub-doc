name: Discord Notification for Pull Requests

on:
  pull_request:
    types: [opened, closed, reopened]

jobs:
  notify_discord:
    runs-on: ubuntu-latest
    steps:
    - name: Send Discord notification
      run: |
        curl -H "Content-Type: application/json" \
        -d '{
          "username": "GitHub PR Bot",
          "avatar_url": "https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png",
          "content": "",
          "embeds": [{
            "title": "üîî Nouvelle Pull Request #${{ github.event.pull_request.number }} - ${{ github.event.pull_request.title }}",
            "description": "${{ github.event.pull_request.body || 'Pas de description fournie.' }}",
            "url": "${{ github.event.pull_request.html_url }}",
            "color": ${{
              github.event.action == 'opened' ? 3066993 : github.event.action == 'closed' ? 15158332 : 15844367
            }},
            "fields": [
              {
                "name": "Auteur",
                "value": "[${{ github.event.pull_request.user.login }}](${{ github.event.pull_request.user.html_url }})",
                "inline": true
              },
              {
                "name": "√âtat",
                "value": "${{ github.event.pull_request.state == 'open' ? 'Ouvert' : 'Ferm√©' }}",
                "inline": true
              },
              {
                "name": "Mergeable",
                "value": "${{ github.event.pull_request.mergeable != null ? (github.event.pull_request.mergeable ? 'Oui' : 'Non') : 'Non d√©fini' }}",
                "inline": true
              }
            ],
            "footer": {
              "text": "D√©p√¥t: ${{ github.repository.name }} | PR Cr√©√©e √†",
              "icon_url": "https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png"
            },
            "timestamp": "${{ github.event.pull_request.created_at }}"
          }]
        }' \
        ${{ secrets.DISCORD_WEBHOOK_URL }}
